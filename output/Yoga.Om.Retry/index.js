// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_Error_Class from "../Control.Monad.Error.Class/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Variant from "../Data.Variant/index.js";
import * as Effect_Aff_Retry from "../Effect.Aff.Retry/index.js";
import * as Yoga_Om from "../Yoga.Om/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Yoga_Om.bindOm);
var ifM = /* #__PURE__ */ Control_Bind.ifM(Yoga_Om.bindOm);
var applyAndDelay = /* #__PURE__ */ Effect_Aff_Retry.applyAndDelay(Yoga_Om.monadAffOm);
var pure = /* #__PURE__ */ Control_Applicative.pure(Yoga_Om.applicativeOm);
var onMatch = /* #__PURE__ */ Data_Variant.onMatch()()();
var throwError = /* #__PURE__ */ Control_Monad_Error_Class.throwError(Yoga_Om.monadThrowVariantExceptio);
var catchError = /* #__PURE__ */ Control_Monad_Error_Class.catchError(Yoga_Om.monadErrorVariantExceptio);
var repeating = function (policy) {
    return function (shouldRepeat) {
        return function (action) {
            var go = function (status) {
                return bind(action(status))(function (result) {
                    return ifM(shouldRepeat(status)(result))(bind(applyAndDelay(policy)(status))(Data_Maybe.maybe(pure(result))(go)))(pure(result));
                });
            };
            return go(Effect_Aff_Retry.defaultRetryStatus);
        };
    };
};
var recovering = function () {
    return function () {
        return function () {
            return function (policy) {
                return function (mkChecks) {
                    return function (action) {
                        var handleErr = function (status) {
                            return function (variant) {
                                var shouldRetry = onMatch(mkChecks(status))(function (v) {
                                    return pure(false);
                                })(variant);
                                return ifM(shouldRetry)(bind(applyAndDelay(policy)(status))(Data_Maybe.maybe(throwError(variant))(go)))(throwError(variant));
                            };
                        };
                        var go = function (status) {
                            return catchError(action(status))(handleErr(status));
                        };
                        return go(Effect_Aff_Retry.defaultRetryStatus);
                    };
                };
            };
        };
    };
};
export {
    recovering,
    repeating
};
export {
    applyAndDelay,
    defaultRetryStatus
} from "../Effect.Aff.Retry/index.js";
//# sourceMappingURL=index.js.map
