// Generated by purs version 0.15.15
import * as $foreign from "./foreign.js";
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Eq from "../Data.Eq/index.js";
import * as Data_Identity from "../Data.Identity/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Effect_Exception from "../Effect.Exception/index.js";
import * as Test_Spec from "../Test.Spec/index.js";
import * as Test_Spec_Assertions from "../Test.Spec.Assertions/index.js";
import * as Yoga_Capnweb from "../Yoga.Capnweb/index.js";
import * as Yoga_Capnweb_Om from "../Yoga.Capnweb.Om/index.js";
import * as Yoga_Om from "../Yoga.Om/index.js";
import * as Yoga_Om_Strom from "../Yoga.Om.Strom/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Effect_Aff.bindAff);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect_Aff.applicativeAff);
var liftEffect = /* #__PURE__ */ Effect_Class.liftEffect(Effect_Aff.monadEffectAff);
var describe = /* #__PURE__ */ Test_Spec.describe(Data_Identity.monadIdentity);
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit)(/* #__PURE__ */ Test_Spec.bindSpecT(Data_Identity.bindIdentity));
var it = /* #__PURE__ */ Test_Spec.it(Data_Identity.monadIdentity)(Test_Spec.exampleMUnit);
var shouldEqual = /* #__PURE__ */ Test_Spec_Assertions.shouldEqual(Effect_Aff.monadThrowAff);
var shouldEqual1 = /* #__PURE__ */ shouldEqual(/* #__PURE__ */ Data_Show.showArray(Data_Show.showString))(/* #__PURE__ */ Data_Eq.eqArray(Data_Eq.eqString));
var shouldEqual2 = /* #__PURE__ */ shouldEqual(/* #__PURE__ */ Data_Show.showArray(Data_Show.showInt))(/* #__PURE__ */ Data_Eq.eqArray(Data_Eq.eqInt));
var shouldEqual3 = /* #__PURE__ */ shouldEqual(Data_Show.showInt)(Data_Eq.eqInt);
var runOm = function (om) {
    return bind(Yoga_Om.runReader({})(om))(function (result) {
        if (result instanceof Data_Either.Right) {
            return pure(result.value0);
        };
        if (result instanceof Data_Either.Left) {
            return liftEffect(Effect_Exception.throwException(Effect_Exception.error("Om error")));
        };
        throw new Error("Failed pattern match at Test.Yoga.Capnweb.OmSpec (line 29, column 3 - line 31, column 61): " + [ result.constructor.name ]);
    });
};
var spec = /* #__PURE__ */ describe("Yoga.Capnweb.Om")(/* #__PURE__ */ discard(/* #__PURE__ */ describe("rpc")(/* #__PURE__ */ discard(/* #__PURE__ */ it("rpc1 returns a single value")(/* #__PURE__ */ bind(/* #__PURE__ */ liftEffect($foreign.mkTestTarget))(function (target) {
    return bind(liftEffect(Yoga_Capnweb.connectPair(target)))(function (conn) {
        return bind(runOm(Yoga_Om_Strom.runCollect(Yoga_Capnweb_Om.rpc1(conn)("ping")("hello"))))(function (result) {
            return shouldEqual1(result)([ "pong: hello" ]);
        });
    });
})))(function () {
    return it("rpc2 passes two arguments")(bind(liftEffect($foreign.mkTestTarget))(function (target) {
        return bind(liftEffect(Yoga_Capnweb.connectPair(target)))(function (conn) {
            return bind(runOm(Yoga_Om_Strom.runCollect(Yoga_Capnweb_Om.rpc2(conn)("add")(3)(4))))(function (result) {
                return shouldEqual2(result)([ 7 ]);
            });
        });
    }));
})))(function () {
    return describe("subscribe")(discard(it("receives pushed values")(bind(liftEffect($foreign.mkTestTarget))(function (target) {
        return bind(liftEffect(Yoga_Capnweb.connectPair(target)))(function (conn) {
            return bind(runOm(Yoga_Om_Strom.runCollect(Yoga_Om_Strom.takeStrom(5)(Yoga_Capnweb_Om.subscribe(conn)("pushItems")))))(function (v) {
                return shouldEqual3(Data_Array.length(v))(5);
            });
        });
    })))(function () {
        return it("cleans up when taking fewer than pushed")(bind(liftEffect($foreign.mkTestTarget))(function (target) {
            return bind(liftEffect(Yoga_Capnweb.connectPair(target)))(function (conn) {
                return bind(runOm(Yoga_Om_Strom.runCollect(Yoga_Om_Strom.takeStrom(2)(Yoga_Capnweb_Om.subscribe(conn)("pushItems")))))(function (v) {
                    return shouldEqual3(Data_Array.length(v))(2);
                });
            });
        }));
    }));
}));
export {
    mkTestTarget,
    delayMs
} from "./foreign.js";
export {
    runOm,
    spec
};
//# sourceMappingURL=index.js.map
