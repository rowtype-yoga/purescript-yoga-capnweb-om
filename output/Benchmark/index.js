// Generated by purs version 0.15.15
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_Error_Class from "../Control.Monad.Error.Class/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_DateTime_Instant from "../Data.DateTime.Instant/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Show from "../Data.Show/index.js";
import * as Data_Time_Duration from "../Data.Time.Duration/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as Effect_Aff from "../Effect.Aff/index.js";
import * as Effect_Class from "../Effect.Class/index.js";
import * as Effect_Class_Console from "../Effect.Class.Console/index.js";
import * as Effect_Now from "../Effect.Now/index.js";
import * as Yoga_Om from "../Yoga.Om/index.js";
import * as Yoga_Om_Strom from "../Yoga.Om.Strom/index.js";
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var discard1 = /* #__PURE__ */ discard(Effect_Aff.bindAff);
var log = /* #__PURE__ */ Effect_Class_Console.log(Effect_Aff.monadEffectAff);
var bind = /* #__PURE__ */ Control_Bind.bind(Effect_Aff.bindAff);
var liftEffect = /* #__PURE__ */ Effect_Class.liftEffect(Effect_Aff.monadEffectAff);
var diff = /* #__PURE__ */ Data_DateTime_Instant.diff(Data_Time_Duration.durationMilliseconds);
var show = /* #__PURE__ */ Data_Show.show(Data_Show.showNumber);
var pure = /* #__PURE__ */ Control_Applicative.pure(Effect_Aff.applicativeAff);
var runOm1 = /* #__PURE__ */ Yoga_Om.runOm()()();
var throwError = /* #__PURE__ */ Control_Monad_Error_Class.throwError(Effect_Aff.monadThrowAff);
var log1 = /* #__PURE__ */ Effect_Class_Console.log(Effect_Class.monadEffectEffect);
var mod = /* #__PURE__ */ Data_EuclideanRing.mod(Data_EuclideanRing.euclideanRingInt);
var show1 = /* #__PURE__ */ Data_Show.show(Data_Show.showInt);
var pure1 = /* #__PURE__ */ Control_Applicative.pure(Yoga_Om.applicativeOm);
var timeOperation = function (name) {
    return function (action) {
        return discard1(log("\x0a\ud83c\udfc3 Running: " + name))(function () {
            return bind(liftEffect(Effect_Now.now))(function (start) {
                return bind(action)(function (result) {
                    return bind(liftEffect(Effect_Now.now))(function (end) {
                        var v = diff(end)(start);
                        return discard1(log("\u2713 Completed in " + (show(v) + "ms")))(function () {
                            return pure(result);
                        });
                    });
                });
            });
        });
    };
};
var runOm = function (om) {
    return runOm1({})({
        exception: function (err) {
            return throwError(err);
        }
    })(om);
};
var reportThroughput = function (name) {
    return function (elements) {
        return function (duration) {
            var elementsPerSec = (1000.0 * Data_Int.toNumber(elements)) / duration;
            var millions = elementsPerSec / 1000000.0;
            return function __do() {
                log1("  \ud83d\udcca " + (name + (": " + (show(elementsPerSec) + " elements/sec"))))();
                return log1("  \ud83d\udcca " + (name + (": " + (show(millions) + "M elements/sec"))))();
            };
        };
    };
};
var main = /* #__PURE__ */ Effect_Aff.launchAff_(/* #__PURE__ */ discard1(/* #__PURE__ */ log("\ud83d\udd25 Strom Performance Benchmark Suite"))(function () {
    return discard1(log("====================================="))(function () {
        return bind(timeOperation("Map 1M elements")(bind(liftEffect(Effect_Now.now))(function (start) {
            return bind(runOm(Yoga_Om_Strom.runDrain(Yoga_Om_Strom.mapStrom(function (v) {
                return v + 1 | 0;
            })(Yoga_Om_Strom.rangeStrom(1)(1000001)))))(function (result) {
                return bind(liftEffect(Effect_Now.now))(function (end) {
                    var v = diff(end)(start);
                    return discard1(liftEffect(reportThroughput("map")(1000000)(v)))(function () {
                        return pure(result);
                    });
                });
            });
        })))(function () {
            return bind(timeOperation("Filter 1M elements (50% kept)")(bind(liftEffect(Effect_Now.now))(function (start) {
                return bind(runOm(Yoga_Om_Strom.runDrain(Yoga_Om_Strom.filterStrom(function (n) {
                    return mod(n)(2) === 0;
                })(Yoga_Om_Strom.rangeStrom(1)(1000001)))))(function (result) {
                    return bind(liftEffect(Effect_Now.now))(function (end) {
                        var v = diff(end)(start);
                        return discard1(liftEffect(reportThroughput("filter")(1000000)(v)))(function () {
                            return pure(result);
                        });
                    });
                });
            })))(function () {
                return bind(timeOperation("Chain 3 maps over 1M elements")(bind(liftEffect(Effect_Now.now))(function (start) {
                    return bind(runOm(Yoga_Om_Strom.runDrain(Yoga_Om_Strom.mapStrom(function (v) {
                        return v - 1 | 0;
                    })(Yoga_Om_Strom.mapStrom(function (v) {
                        return v * 2 | 0;
                    })(Yoga_Om_Strom.mapStrom(function (v) {
                        return v + 1 | 0;
                    })(Yoga_Om_Strom.rangeStrom(1)(1000001)))))))(function (result) {
                        return bind(liftEffect(Effect_Now.now))(function (end) {
                            var v = diff(end)(start);
                            return discard1(liftEffect(reportThroughput("3x map")(1000000)(v)))(function () {
                                return pure(result);
                            });
                        });
                    });
                })))(function () {
                    return bind(timeOperation("Complex pipeline (map, filter, map) on 1M elements")(bind(liftEffect(Effect_Now.now))(function (start) {
                        return bind(runOm(Yoga_Om_Strom.runDrain(Yoga_Om_Strom.mapStrom(function (v) {
                            return v * 2 | 0;
                        })(Yoga_Om_Strom.filterStrom(function (n) {
                            return mod(n)(3) === 0;
                        })(Yoga_Om_Strom.mapStrom(function (v) {
                            return v + 1 | 0;
                        })(Yoga_Om_Strom.rangeStrom(1)(1000001)))))))(function (result) {
                            return bind(liftEffect(Effect_Now.now))(function (end) {
                                var v = diff(end)(start);
                                return discard1(liftEffect(reportThroughput("pipeline")(1000000)(v)))(function () {
                                    return pure(result);
                                });
                            });
                        });
                    })))(function () {
                        return bind(timeOperation("Fold 1M elements (sum)")(bind(liftEffect(Effect_Now.now))(function (start) {
                            return bind(runOm(Yoga_Om_Strom.runFold(0)(function (acc) {
                                return function (n) {
                                    return acc + n | 0;
                                };
                            })(Yoga_Om_Strom.rangeStrom(1)(1000001))))(function (result) {
                                return bind(liftEffect(Effect_Now.now))(function (end) {
                                    var v = diff(end)(start);
                                    return discard1(liftEffect(reportThroughput("fold")(1000000)(v)))(function () {
                                        return discard1(log("  Result: " + show1(result)))(function () {
                                            return pure(result);
                                        });
                                    });
                                });
                            });
                        })))(function () {
                            return bind(timeOperation("Collect 100K elements")(bind(liftEffect(Effect_Now.now))(function (start) {
                                return bind(runOm(Yoga_Om_Strom.runCollect(Yoga_Om_Strom.rangeStrom(1)(100001))))(function (result) {
                                    return bind(liftEffect(Effect_Now.now))(function (end) {
                                        var v = diff(end)(start);
                                        return discard1(liftEffect(reportThroughput("collect")(100000)(v)))(function () {
                                            return discard1(log("  Array size: " + show1(Data_Array.length(result))))(function () {
                                                return pure(result);
                                            });
                                        });
                                    });
                                });
                            })))(function () {
                                return bind(timeOperation("Take 10K from 1M elements")(bind(liftEffect(Effect_Now.now))(function (start) {
                                    return bind(runOm(Yoga_Om_Strom.runDrain(Yoga_Om_Strom.takeStrom(10000)(Yoga_Om_Strom.rangeStrom(1)(1000001)))))(function (result) {
                                        return bind(liftEffect(Effect_Now.now))(function (end) {
                                            var v = diff(end)(start);
                                            return discard1(log("  Duration: " + (show(v) + "ms (should be fast!)")))(function () {
                                                return pure(result);
                                            });
                                        });
                                    });
                                })))(function () {
                                    return bind(timeOperation("Non-deterministic merge of 2x500K elements")(bind(liftEffect(Effect_Now.now))(function (start) {
                                        return bind(runOm(Yoga_Om_Strom.runDrain(Yoga_Om_Strom.mergeND(Yoga_Om_Strom.rangeStrom(1)(500001))(Yoga_Om_Strom.rangeStrom(500001)(1000001)))))(function (result) {
                                            return bind(liftEffect(Effect_Now.now))(function (end) {
                                                var v = diff(end)(start);
                                                return discard1(liftEffect(reportThroughput("mergeND")(1000000)(v)))(function () {
                                                    return pure(result);
                                                });
                                            });
                                        });
                                    })))(function () {
                                        return bind(timeOperation("Parallel map (concurrency=4) on 1000 elements")(bind(liftEffect(Effect_Now.now))(function (start) {
                                            return bind(runOm(Yoga_Om_Strom.runDrain(Yoga_Om_Strom.mapPar(4)(function (n) {
                                                return pure1(n * 2 | 0);
                                            })(Yoga_Om_Strom.rangeStrom(1)(1001)))))(function (result) {
                                                return bind(liftEffect(Effect_Now.now))(function (end) {
                                                    var v = diff(end)(start);
                                                    return discard1(liftEffect(reportThroughput("mapPar(4)")(1000)(v)))(function () {
                                                        return pure(result);
                                                    });
                                                });
                                            });
                                        })))(function () {
                                            return bind(timeOperation("Infinite stream, take 1M elements")(bind(liftEffect(Effect_Now.now))(function (start) {
                                                return bind(runOm(Yoga_Om_Strom.runDrain(Yoga_Om_Strom.takeStrom(1000000)(Yoga_Om_Strom.iterateStromInfinite(function (v) {
                                                    return v + 1 | 0;
                                                })(0)))))(function (result) {
                                                    return bind(liftEffect(Effect_Now.now))(function (end) {
                                                        var v = diff(end)(start);
                                                        return discard1(liftEffect(reportThroughput("infinite+take")(1000000)(v)))(function () {
                                                            return pure(result);
                                                        });
                                                    });
                                                });
                                            })))(function () {
                                                return bind(timeOperation("Scan (running sum) over 1M elements")(bind(liftEffect(Effect_Now.now))(function (start) {
                                                    return bind(runOm(Yoga_Om_Strom.runDrain(Yoga_Om_Strom.scanStrom(function (acc) {
                                                        return function (n) {
                                                            return acc + n | 0;
                                                        };
                                                    })(0)(Yoga_Om_Strom.rangeStrom(1)(1000001)))))(function (result) {
                                                        return bind(liftEffect(Effect_Now.now))(function (end) {
                                                            var v = diff(end)(start);
                                                            return discard1(liftEffect(reportThroughput("scan")(1000000)(v)))(function () {
                                                                return pure(result);
                                                            });
                                                        });
                                                    });
                                                })))(function () {
                                                    return bind(timeOperation("Unfold 100K elements")(bind(liftEffect(Effect_Now.now))(function (start) {
                                                        return bind(runOm(Yoga_Om_Strom.runDrain(Yoga_Om_Strom.unfoldStrom(function (n) {
                                                            var $57 = n > 100000;
                                                            if ($57) {
                                                                return Data_Maybe.Nothing.value;
                                                            };
                                                            return new Data_Maybe.Just(new Data_Tuple.Tuple(n, n + 1 | 0));
                                                        })(1))))(function (result) {
                                                            return bind(liftEffect(Effect_Now.now))(function (end) {
                                                                var v = diff(end)(start);
                                                                return discard1(liftEffect(reportThroughput("unfold")(100000)(v)))(function () {
                                                                    return pure(result);
                                                                });
                                                            });
                                                        });
                                                    })))(function () {
                                                        return discard1(log("\x0a\u2728 Benchmark suite complete!"))(function () {
                                                            return discard1(log("\x0a\ud83d\udcc8 Summary:"))(function () {
                                                                return discard1(log("- Basic operations (map, filter): should be 1-10M elements/sec"))(function () {
                                                                    return discard1(log("- Pipelines: still fast due to chunking"))(function () {
                                                                        return discard1(log("- Take/early termination: should be near-instant"))(function () {
                                                                            return discard1(log("- Concurrent operations: good speedup"))(function () {
                                                                                return log("- Infinite streams: stack-safe and fast");
                                                                            });
                                                                        });
                                                                    });
                                                                });
                                                            });
                                                        });
                                                    });
                                                });
                                            });
                                        });
                                    });
                                });
                            });
                        });
                    });
                });
            });
        });
    });
}));
export {
    timeOperation,
    reportThroughput,
    runOm,
    main
};
//# sourceMappingURL=index.js.map
